<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    
      <meta charset="utf-8">

<meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ross A. Baker: abe: a server for personal, self-hosted services</title>



  <meta name="description" content="abe is a Hetzner Robot server that runs several personal services.">



  
  
  <link rel="stylesheet" href="/css/sanitize.min.aff94e5b4264fbc756e1f961da6345decc6c55c97f01733a04419f1a12b2daba.css">
  
  <link rel="preload" href="/css/sanitize.min.aff94e5b4264fbc756e1f961da6345decc6c55c97f01733a04419f1a12b2daba.css" as="style">

  
  
  <link rel="stylesheet" href="/css/assets.min.e1aa19b7b34925a0f478831cb9b1efbded8fceeaf559dbdc1cbe5ee00b1992fd.css">
  
  <link rel="preload" href="/css/assets.min.e1aa19b7b34925a0f478831cb9b1efbded8fceeaf559dbdc1cbe5ee00b1992fd.css" as="style">

  
  
  <link rel="stylesheet" href="/css/cromulent.min.f903da9efc97539fdab1c15148dba3dbda4745f4797187764453815db70e39ff.css">
  
  <link rel="preload" href="/css/cromulent.min.f903da9efc97539fdab1c15148dba3dbda4745f4797187764453815db70e39ff.css" as="style">

  
  
  <link rel="stylesheet" href="/css/chroma.min.1fd55e98fdc858a7c9d423a512014a936202c852840c2b48c04300634fa3eef3.css">
  
  <link rel="preload" href="/css/chroma.min.1fd55e98fdc858a7c9d423a512014a936202c852840c2b48c04300634fa3eef3.css" as="style">



  
  
  <script defer src="/js/copy-button.min.b3814956fbbab3c2ca2da8ca65b880c596b2d7e0acf0158603f5bdd12deca671.js"></script>
  
  <link rel="preload" href="/js/copy-button.min.b3814956fbbab3c2ca2da8ca65b880c596b2d7e0acf0158603f5bdd12deca671.js" as="script">


<link rel="icon" href="/img/profile.ico">



    
  </head>

  <body>
    <header>
      
        <strong><a href="/">rossabaker</a></strong>
<p>A perfectly cromulent developer.</p>
<nav>
  <ul>
    
      <li><a href="/about">about</a></li>
    
      <li><a href="/blog">blog</a></li>
    
      <li><a href="/talks">talks</a></li>
    
      <li><a href="/projects">projects</a></li>
    
      <li><a href="/configs">configs</a></li>
    
      <li><a href="/categories">categories</a></li>
    
      <li><a href="/tags">tags</a></li>
    
  </ul>
</nav>

      
    </header>

    <main>
      
  <article>
    <header>
      <h1>abe: a server for personal, self-hosted services</h1>
    </header>
    <p><code>abe</code> is a dedicated server on <a href="https://docs.hetzner.com/robot/">Hetzner Robot</a>.  It&rsquo;s not a revenue
driver, so it was picked up on <a href="https://www.hetzner.com/sb">server auction</a> to save a few Euro.</p>
<h2 id="provisioning">
  Provisioning
  <a class="heading-anchor" href="#provisioning">#</a>
</h2>
<p>Ideally, the entire server would provisioned by <a href="https://opentofu.org/">OpenTofu</a>, but Hetzner
Robot instances aren&rsquo;t as ephemeral as Hetzner Cloud.  NixOS was
installed from the rescue image with a <a href="https://github.com/nix-community/nixos-install-scripts/blob/5dc786009cf8595090bfa8e337df2ff1693e825a/hosters/hetzner-dedicated/hetzner-dedicated-wipe-and-install-nixos.sh">Nix community script</a>.</p>
<h2 id="base-configuration">
  Base configuration
  <a class="heading-anchor" href="#base-configuration">#</a>
</h2>
<div class="code-snippet"><p class="license">CC-BY-SA-4.0</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nix" data-lang="nix"><span class="line"><span class="cl"><span class="p">{</span> <span class="n">config</span><span class="o">,</span> <span class="n">pkgs</span><span class="o">,</span> <span class="o">...</span> <span class="p">}:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">imports</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span> <span class="c1"># Include the results of the hardware scan.</span>
</span></span><span class="line"><span class="cl">      <span class="sr">./hardware-configuration.nix</span>
</span></span><span class="line"><span class="cl">      <span class="sr">./users.nix</span>
</span></span><span class="line"><span class="cl">      <span class="sr">./mastodon.nix</span>
</span></span><span class="line"><span class="cl">      <span class="sr">./borgbackup.nix</span>
</span></span><span class="line"><span class="cl">      <span class="sr">./libravatar.nix</span>
</span></span><span class="line"><span class="cl">    <span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Use GRUB2 as the boot loader.</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># We don&#39;t use systemd-boot because Hetzner uses BIOS legacy boot.</span>
</span></span><span class="line"><span class="cl">  <span class="n">boot</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">systemd-boot</span><span class="o">.</span><span class="n">enable</span> <span class="o">=</span> <span class="no">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">boot</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">grub</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">enable</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">efiSupport</span> <span class="o">=</span> <span class="no">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">devices</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&#34;/dev/sda&#34;</span> <span class="s2">&#34;/dev/sdb&#34;</span> <span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">networking</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">hostName</span> <span class="o">=</span> <span class="s2">&#34;abe&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">domain</span> <span class="o">=</span> <span class="s2">&#34;hetzner.rossabaker.com&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># The mdadm RAID1s were created with &#39;mdadm --create ... --homehost=hetzner&#39;,</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># but the hostname for each machine may be different, and mdadm&#39;s HOMEHOST</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># setting defaults to &#39;&lt;system&gt;&#39; (using the system hostname).</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># This results mdadm considering such disks as &#34;foreign&#34; as opposed to</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># &#34;local&#34;, and showing them as e.g. &#39;/dev/md/hetzner:root0&#39;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># instead of &#39;/dev/md/root0&#39;.</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># This is mdadm&#39;s protection against accidentally putting a RAID disk</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># into the wrong machine and corrupting data by accidental sync, see</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># https://bugzilla.redhat.com/show_bug.cgi?id=606481#c14 and onward.</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># We do not worry about plugging disks into the wrong machine because</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># we will never exchange disks between machines, so we tell mdadm to</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># ignore the homehost entirely.</span>
</span></span><span class="line"><span class="cl">  <span class="n">environment</span><span class="o">.</span><span class="n">etc</span><span class="o">.</span><span class="s2">&#34;mdadm.conf&#34;</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">    HOMEHOST &lt;ignore&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">  &#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># The RAIDs are assembled in stage1, so we need to make the config</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># available there.</span>
</span></span><span class="line"><span class="cl">  <span class="n">boot</span><span class="o">.</span><span class="n">swraid</span><span class="o">.</span><span class="n">mdadmConf</span> <span class="o">=</span> <span class="s1">&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">    HOMEHOST &lt;ignore&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">  &#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Network (Hetzner uses static IP assignments, and we don&#39;t use DHCP here)</span>
</span></span><span class="line"><span class="cl">  <span class="n">networking</span><span class="o">.</span><span class="n">useDHCP</span> <span class="o">=</span> <span class="no">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">networking</span><span class="o">.</span><span class="n">interfaces</span><span class="o">.</span><span class="s2">&#34;enp27s0&#34;</span><span class="o">.</span><span class="n">ipv4</span><span class="o">.</span><span class="n">addresses</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">address</span> <span class="o">=</span> <span class="s2">&#34;95.216.32.37&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">prefixLength</span> <span class="o">=</span> <span class="mi">26</span><span class="p">;</span> <span class="c1"># netmask 255.255.255.192</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="n">networking</span><span class="o">.</span><span class="n">interfaces</span><span class="o">.</span><span class="s2">&#34;enp27s0&#34;</span><span class="o">.</span><span class="n">ipv6</span><span class="o">.</span><span class="n">addresses</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">address</span> <span class="o">=</span> <span class="s2">&#34;2a01:4f9:2a:2047::1&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">prefixLength</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="n">networking</span><span class="o">.</span><span class="n">defaultGateway</span> <span class="o">=</span> <span class="s2">&#34;95.216.32.1&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">networking</span><span class="o">.</span><span class="n">defaultGateway6</span> <span class="o">=</span> <span class="p">{</span> <span class="n">address</span> <span class="o">=</span> <span class="s2">&#34;fe80::1&#34;</span><span class="p">;</span> <span class="n">interface</span> <span class="o">=</span> <span class="s2">&#34;enp27s0&#34;</span><span class="p">;</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="n">networking</span><span class="o">.</span><span class="n">nameservers</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&#34;8.8.8.8&#34;</span> <span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Initial empty root password for easy login:</span>
</span></span><span class="line"><span class="cl">  <span class="n">users</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">initialHashedPassword</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">services</span><span class="o">.</span><span class="n">openssh</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">PermitRootLogin</span> <span class="o">=</span> <span class="s2">&#34;prohibit-password&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">users</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">openssh</span><span class="o">.</span><span class="n">authorizedKeys</span><span class="o">.</span><span class="n">keys</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIFTwvnkKWbNTAPSiK/agHOV9xXoh1R6hx5B8lZYmPY6Z&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">services</span><span class="o">.</span><span class="n">openssh</span><span class="o">.</span><span class="n">enable</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">system</span><span class="o">.</span><span class="n">stateVersion</span> <span class="o">=</span> <span class="s2">&#34;23.05&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></div>
<h2 id="hardware-configuration">
  Hardware configuration
  <a class="heading-anchor" href="#hardware-configuration">#</a>
</h2>
<p>Most NixOS configurations import a generated file describing the
hardware.  This is no exception.</p>
<details>
<summary>Generated code</summary>
<div class="details">
<div class="code-snippet"><p class="license">CC-BY-SA-4.0</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nix" data-lang="nix"><span class="line"><span class="cl"><span class="c1"># Do not modify this file!  It was generated by ‘nixos-generate-config’</span>
</span></span><span class="line"><span class="cl"><span class="c1"># and may be overwritten by future invocations.  Please make changes</span>
</span></span><span class="line"><span class="cl"><span class="c1"># to /etc/nixos/configuration.nix instead.</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span> <span class="n">config</span><span class="o">,</span> <span class="n">lib</span><span class="o">,</span> <span class="n">pkgs</span><span class="o">,</span> <span class="n">modulesPath</span><span class="o">,</span> <span class="o">...</span> <span class="p">}:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">imports</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span> <span class="p">(</span><span class="n">modulesPath</span> <span class="o">+</span> <span class="s2">&#34;/installer/scan/not-detected.nix&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">boot</span><span class="o">.</span><span class="n">initrd</span><span class="o">.</span><span class="n">availableKernelModules</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&#34;ahci&#34;</span> <span class="s2">&#34;sd_mod&#34;</span> <span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="n">boot</span><span class="o">.</span><span class="n">initrd</span><span class="o">.</span><span class="n">kernelModules</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&#34;dm-snapshot&#34;</span> <span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="n">boot</span><span class="o">.</span><span class="n">kernelModules</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&#34;kvm-amd&#34;</span> <span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="n">boot</span><span class="o">.</span><span class="n">extraModulePackages</span> <span class="o">=</span> <span class="p">[</span> <span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">fileSystems</span><span class="o">.</span><span class="s2">&#34;/&#34;</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span> <span class="n">device</span> <span class="o">=</span> <span class="s2">&#34;/dev/disk/by-uuid/562ecb2a-b924-4aa0-92c5-c55594a24cc8&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">fsType</span> <span class="o">=</span> <span class="s2">&#34;ext4&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">swapDevices</span> <span class="o">=</span> <span class="p">[</span> <span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Enables DHCP on each ethernet and wireless interface. In case of scripted networking</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># (the default) this is the recommended approach. When using systemd-networkd it&#39;s</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># still possible to use this option, but it&#39;s recommended to use it in conjunction</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># with explicit per-interface declarations with `networking.interfaces.&lt;interface&gt;.useDHCP`.</span>
</span></span><span class="line"><span class="cl">  <span class="n">networking</span><span class="o">.</span><span class="n">useDHCP</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">mkDefault</span> <span class="no">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># networking.interfaces.eth0.useDHCP = lib.mkDefault true;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">nixpkgs</span><span class="o">.</span><span class="n">hostPlatform</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">mkDefault</span> <span class="s2">&#34;x86_64-linux&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">powerManagement</span><span class="o">.</span><span class="n">cpuFreqGovernor</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">mkDefault</span> <span class="s2">&#34;ondemand&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">hardware</span><span class="o">.</span><span class="n">cpu</span><span class="o">.</span><span class="n">amd</span><span class="o">.</span><span class="n">updateMicrocode</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">mkDefault</span> <span class="n">config</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">enableRedistributableFirmware</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></div>
</div>
</details>
<h2 id="users">
  Users
  <a class="heading-anchor" href="#users">#</a>
</h2>
<p>Just a stub for my personal user.</p>
<div class="code-snippet"><p class="license">CC-BY-SA-4.0</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nix" data-lang="nix"><span class="line"><span class="cl"><span class="p">{</span> <span class="o">...</span> <span class="p">}:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">users</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">ross</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">isNormalUser</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">description</span> <span class="o">=</span> <span class="s2">&#34;Ross A. Baker&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">extraGroups</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&#34;wheel&#34;</span> <span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">openssh</span><span class="o">.</span><span class="n">authorizedKeys</span><span class="o">.</span><span class="n">keys</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIFTwvnkKWbNTAPSiK/agHOV9xXoh1R6hx5B8lZYmPY6Z&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></div>
<h2 id="backup-to-storage-box-with-borg">
  Backup to Storage Box with Borg
  <a class="heading-anchor" href="#backup-to-storage-box-with-borg">#</a>
</h2>
<p>A Hetzner dedicated server includes a 100-gigabyte <a href="https://www.hetzner.com/storage/storage-box">Storage Box</a>.
Nightly backups are made using <a href="https://www.borgbackup.org/">Borg</a> via the <a href="https://nixos.org/manual/nixos/stable/#module-borgbase">NixOS <code>borgbackup</code> module</a>.
All data is encrypted with a secret provisioned by <a href="https://github.com/ryantm/agenix">agenix</a>.</p>
<div class="code-snippet"><p class="license">CC-BY-SA-4.0</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nix" data-lang="nix"><span class="line"><span class="cl"><span class="p">{</span> <span class="n">config</span><span class="o">,</span> <span class="o">...</span> <span class="p">}:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">age</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">abe-backups-default</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="sr">../../../../src/secrets/abe-backups-default.age</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">services</span><span class="o">.</span><span class="n">borgbackup</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;/etc&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;/home&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;/var&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;/root&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">exclude</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;/var/cache&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;/var/tmp&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">encryption</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">mode</span> <span class="o">=</span> <span class="s2">&#34;repokey-blake2&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">passCommand</span> <span class="o">=</span> <span class="s2">&#34;cat </span><span class="si">${</span><span class="n">config</span><span class="o">.</span><span class="n">age</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">abe-backups-default</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="n">repo</span> <span class="o">=</span> <span class="s2">&#34;ssh://u377329@u377329.your-storagebox.de:23/home/backups/abe/default&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">doInit</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">compression</span> <span class="o">=</span> <span class="s2">&#34;auto,zstd&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">startAt</span> <span class="o">=</span> <span class="s2">&#34;daily&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></div>
<h2 id="mastodon">
  Mastodon
  <a class="heading-anchor" href="#mastodon">#</a>
</h2>
<p><a href="https://social.rossabaker.com/about"><code>social.rossabaker.com</code></a> is a single-user Mastodon instance.</p>
<p>The Nginx configuration is duplicative of the NixOS module in order
to configure the <a href="https://docs.joinmastodon.org/admin/config/#web_domain"><code>WEB_DOMAIN</code></a> instead of the <a href="https://docs.joinmastodon.org/admin/config/#local_domain"><code>LOCAL_DOMAIN</code></a>.</p>
<div class="code-snippet"><p class="license">CC-BY-SA-4.0</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nix" data-lang="nix"><span class="line"><span class="cl"><span class="p">{</span> <span class="n">config</span><span class="o">,</span> <span class="n">lib</span><span class="o">,</span> <span class="o">...</span> <span class="p">}:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">let</span>
</span></span><span class="line"><span class="cl">  <span class="n">cfg</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">mastodon</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">in</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">services</span><span class="o">.</span><span class="n">mastodon</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">enable</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">localDomain</span> <span class="o">=</span> <span class="s2">&#34;rossabaker.com&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">extraConfig</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">WEB_DOMAIN</span> <span class="o">=</span> <span class="s2">&#34;social.rossabaker.com&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="n">configureNginx</span> <span class="o">=</span> <span class="no">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">smtp</span><span class="o">.</span><span class="n">fromAddress</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">streamingProcesses</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">networking</span><span class="o">.</span><span class="n">firewall</span><span class="o">.</span><span class="n">allowedTCPPorts</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">80</span> <span class="mi">443</span> <span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># The default module configures localDomain.  We need to configure</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># the WEB_DOMAIN.  This is a nasty copy-and-paste.</span>
</span></span><span class="line"><span class="cl">  <span class="n">services</span><span class="o">.</span><span class="n">nginx</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">enable</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">recommendedProxySettings</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span> <span class="c1"># required for redirections to work</span>
</span></span><span class="line"><span class="cl">    <span class="n">virtualHosts</span><span class="o">.</span><span class="s2">&#34;</span><span class="si">${</span><span class="n">cfg</span><span class="o">.</span><span class="n">extraConfig</span><span class="o">.</span><span class="n">WEB_DOMAIN</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">root</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="si">${</span><span class="n">cfg</span><span class="o">.</span><span class="n">package</span><span class="si">}</span><span class="s2">/public/&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="c1"># mastodon only supports https, but you can override this if you offload tls elsewhere.</span>
</span></span><span class="line"><span class="cl">      <span class="n">forceSSL</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">mkDefault</span> <span class="no">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">enableACME</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">mkDefault</span> <span class="no">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">locations</span><span class="o">.</span><span class="s2">&#34;/system/&#34;</span><span class="o">.</span><span class="n">alias</span> <span class="o">=</span> <span class="s2">&#34;/var/lib/mastodon/public-system/&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">locations</span><span class="o">.</span><span class="s2">&#34;/&#34;</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">tryFiles</span> <span class="o">=</span> <span class="s2">&#34;$uri @proxy&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">locations</span><span class="o">.</span><span class="s2">&#34;@proxy&#34;</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">proxyPass</span> <span class="o">=</span> <span class="p">(</span><span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">enableUnixSocket</span> <span class="k">then</span> <span class="s2">&#34;http://unix:/run/mastodon-web/web.socket&#34;</span> <span class="k">else</span> <span class="s2">&#34;http://127.0.0.1:</span><span class="si">${</span><span class="nb">toString</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">webPort</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">proxyWebsockets</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">locations</span><span class="o">.</span><span class="s2">&#34;/api/v1/streaming/&#34;</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">proxyPass</span> <span class="o">=</span> <span class="s2">&#34;http://mastodon-streaming&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">proxyWebsockets</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="n">upstreams</span><span class="o">.</span><span class="n">mastodon-streaming</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">extraConfig</span> <span class="o">=</span> <span class="s1">&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">        least_conn;
</span></span></span><span class="line"><span class="cl"><span class="s1">      &#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">servers</span> <span class="o">=</span> <span class="nb">builtins</span><span class="o">.</span><span class="n">listToAttrs</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">map</span> <span class="p">(</span><span class="n">i</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;unix:/run/mastodon-streaming/streaming-</span><span class="si">${</span><span class="nb">toString</span> <span class="n">i</span><span class="si">}</span><span class="s2">.socket&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="n">value</span> <span class="o">=</span> <span class="p">{</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span> <span class="p">(</span><span class="n">lib</span><span class="o">.</span><span class="n">range</span> <span class="mi">1</span> <span class="n">cfg</span><span class="o">.</span><span class="n">streamingProcesses</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">users</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="si">${</span><span class="n">cfg</span><span class="o">.</span><span class="n">group</span><span class="si">}</span><span class="o">.</span><span class="n">members</span> <span class="o">=</span> <span class="p">[</span> <span class="n">config</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">nginx</span><span class="o">.</span><span class="n">user</span> <span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></div>
<h2 id="flake-module">
  Flake module
  <a class="heading-anchor" href="#flake-module">#</a>
</h2>
<p><code>abe</code>&rsquo;s configuration, and a home configuration for user <code>ross@abe</code>,
are published as a flake module.</p>
<div class="code-snippet"><p class="license">CC-BY-SA-4.0</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nix" data-lang="nix"><span class="line"><span class="cl"><span class="p">{</span> <span class="n">inputs</span><span class="o">,</span> <span class="n">self</span><span class="o">,</span> <span class="n">withSystem</span><span class="o">,</span> <span class="o">...</span> <span class="p">}:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">flake</span> <span class="o">=</span> <span class="n">withSystem</span> <span class="s2">&#34;x86_64-linux&#34;</span> <span class="p">(</span> <span class="n">ctx</span><span class="o">@</span><span class="p">{</span> <span class="n">pkgs</span><span class="o">,</span> <span class="n">system</span><span class="o">,</span> <span class="o">...</span> <span class="p">}:</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">nixosConfigurations</span><span class="o">.</span><span class="n">abe</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">        <span class="n">inputs</span><span class="o">.</span><span class="n">nixpkgs</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">nixosSystem</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">inherit</span> <span class="n">system</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="n">modules</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="sr">./configuration.nix</span>
</span></span><span class="line"><span class="cl">            <span class="n">inputs</span><span class="o">.</span><span class="n">nixos-dns</span><span class="o">.</span><span class="n">nixosModules</span><span class="o">.</span><span class="n">dns</span>
</span></span><span class="line"><span class="cl">            <span class="sr">./dns</span>
</span></span><span class="line"><span class="cl">            <span class="n">self</span><span class="o">.</span><span class="n">nixosModules</span><span class="o">.</span><span class="n">netdata</span>
</span></span><span class="line"><span class="cl">            <span class="n">self</span><span class="o">.</span><span class="n">nixosModules</span><span class="o">.</span><span class="n">synapse</span>
</span></span><span class="line"><span class="cl">            <span class="n">self</span><span class="o">.</span><span class="n">nixosModules</span><span class="o">.</span><span class="n">forgejo</span>
</span></span><span class="line"><span class="cl">            <span class="n">self</span><span class="o">.</span><span class="n">nixosModules</span><span class="o">.</span><span class="n">forgejoActions</span>
</span></span><span class="line"><span class="cl">            <span class="n">self</span><span class="o">.</span><span class="n">nixosModules</span><span class="o">.</span><span class="n">opengist</span>
</span></span><span class="line"><span class="cl">            <span class="n">self</span><span class="o">.</span><span class="n">nixosModules</span><span class="o">.</span><span class="n">acme</span>
</span></span><span class="line"><span class="cl">            <span class="n">self</span><span class="o">.</span><span class="n">nixosModules</span><span class="o">.</span><span class="n">webserver</span>
</span></span><span class="line"><span class="cl">            <span class="n">self</span><span class="o">.</span><span class="n">nixosModules</span><span class="o">.</span><span class="n">libravatar</span>
</span></span><span class="line"><span class="cl">            <span class="n">self</span><span class="o">.</span><span class="n">nixosModules</span><span class="o">.</span><span class="n">podman</span>
</span></span><span class="line"><span class="cl">            <span class="n">inputs</span><span class="o">.</span><span class="n">agenix</span><span class="o">.</span><span class="n">nixosModules</span><span class="o">.</span><span class="n">default</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="c1"># TODO This is missing...</span>
</span></span><span class="line"><span class="cl">              <span class="n">nix</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">substituters</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&#34;https://cache.nixos.org/&#34;</span> <span class="p">];</span>
</span></span><span class="line"><span class="cl">                <span class="n">trusted-public-keys</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&#34;cache.nixos.org-1:6NCHdD59X431o0gWypbMrAURkbJ16ZPMQFGspcDShjY=&#34;</span> <span class="p">];</span>
</span></span><span class="line"><span class="cl">              <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              <span class="n">cromulent</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">opengist</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">enabled</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="n">domain</span> <span class="o">=</span> <span class="s2">&#34;paste.rossabaker.com&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">              <span class="p">};</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">homeConfigurations</span><span class="o">.</span><span class="s2">&#34;ross@abe&#34;</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">        <span class="n">inputs</span><span class="o">.</span><span class="n">home-manager</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">homeManagerConfiguration</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">inherit</span> <span class="n">pkgs</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="n">modules</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="n">self</span><span class="o">.</span><span class="n">homeModules</span><span class="o">.</span><span class="n">default</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="n">home</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="s2">&#34;ross&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">              <span class="n">home</span><span class="o">.</span><span class="n">homeDirectory</span> <span class="o">=</span> <span class="s2">&#34;/home/ross&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="c1"># TODO This is missing...</span>
</span></span><span class="line"><span class="cl">              <span class="n">nix</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">substituters</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&#34;https://cache.nixos.org/&#34;</span> <span class="p">];</span>
</span></span><span class="line"><span class="cl">                <span class="n">trusted-public-keys</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&#34;cache.nixos.org-1:6NCHdD59X431o0gWypbMrAURkbJ16ZPMQFGspcDShjY=&#34;</span> <span class="p">];</span>
</span></span><span class="line"><span class="cl">              <span class="p">};</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="c1"># Sloppy fix for now</span>
</span></span><span class="line"><span class="cl">              <span class="n">nix</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">extraOptions</span> <span class="o">=</span> <span class="s1">&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">                  experimental-features = nix-command flakes
</span></span></span><span class="line"><span class="cl"><span class="s1">                &#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">              <span class="p">};</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></div>
<h2 id="libravatar-setup">
  Libravatar setup
  <a class="heading-anchor" href="#libravatar-setup">#</a>
</h2>
<p>This server hosts <a href="/configs/libravatar/">Libravatar</a>.</p>
<h3 id="nixos-module">
  NixOS module
  <a class="heading-anchor" href="#nixos-module">#</a>
</h3>
<p>Nix needs to know what domain to host the avatars on, and where to
find the source avatars.</p>
<div class="code-snippet"><p class="license">CC-BY-SA-4.0</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nix" data-lang="nix"><span class="line"><span class="cl"><span class="p">{</span> <span class="n">config</span><span class="o">,</span> <span class="o">...</span> <span class="p">}:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">com</span><span class="o">.</span><span class="n">rossabaker</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">libravatar</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">domain</span> <span class="o">=</span> <span class="s2">&#34;avatars.rossabaker.com&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">avatarSrc</span> <span class="o">=</span> <span class="sr">../../../../src/avatars</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></div>
<h2 id="dns-records">
  DNS records
  <a class="heading-anchor" href="#dns-records">#</a>
</h2>
<p>DNS records for <code>abe</code> and the services it hosts are managed by
<a href="https://github.com/Janik-Haag/NixOS-DNS/">NixOS-DNS</a>.  The actual DNS records are defined in
<code>networking.domains.subDomains</code>, but each gets its defaults from the
closest matching <code>networking.domains.baseDomains</code>.  We don&rsquo;t specify
any defaults, but if there is no matching record in <code>baseDomains</code>, no
record is generated at all!</p>
<div class="warning">
<p>Forgetting <code>baseDomains</code> is <a href="https://janik-haag.github.io/NixOS-DNS/usage.html#nixos-module">documented as an error</a>, but I saw silent
failure.</p>
</div>
<div class="code-snippet"><p class="license">CC-BY-SA-4.0</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nix" data-lang="nix"><span class="line"><span class="cl"><span class="p">{</span> <span class="n">config</span><span class="o">,</span> <span class="o">...</span> <span class="p">}:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">imports</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">   <span class="sr">./addresses.nix</span>
</span></span><span class="line"><span class="cl">   <span class="sr">./cnames.nix</span>
</span></span><span class="line"><span class="cl">  <span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">networking</span><span class="o">.</span><span class="n">domains</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">enable</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">baseDomains</span><span class="o">.</span><span class="s2">&#34;rossabaker.com&#34;</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></div>
<h3 id="address-records">
  Address records
  <a class="heading-anchor" href="#address-records">#</a>
</h3>
<p>Generate DNS address records <code>A</code> and <code>AAAA</code>.  Most of it can be
inferred from the standard NixOS <code>networking</code> config.  We give it a
hint which is the public network interface.</p>
<p>The same records are set for the apex domain, <code>rossabaker.com</code>, so
we can host the website.</p>
<div class="code-snippet"><p class="license">CC-BY-SA-4.0</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nix" data-lang="nix"><span class="line"><span class="cl"><span class="p">{</span> <span class="n">config</span><span class="o">,</span> <span class="o">...</span> <span class="p">}:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">builtins</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">let</span>
</span></span><span class="line"><span class="cl">  <span class="n">iface</span> <span class="o">=</span> <span class="s2">&#34;enp27s0&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">fqdn</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="si">${</span><span class="n">config</span><span class="o">.</span><span class="n">networking</span><span class="o">.</span><span class="n">hostName</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="n">config</span><span class="o">.</span><span class="n">networking</span><span class="o">.</span><span class="n">domain</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">ipv4Addresses</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">networking</span><span class="o">.</span><span class="n">interfaces</span><span class="o">.</span><span class="si">${</span><span class="n">iface</span><span class="si">}</span><span class="o">.</span><span class="n">ipv4</span><span class="o">.</span><span class="n">addresses</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">ipv6Addresses</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">networking</span><span class="o">.</span><span class="n">interfaces</span><span class="o">.</span><span class="si">${</span><span class="n">iface</span><span class="si">}</span><span class="o">.</span><span class="n">ipv6</span><span class="o">.</span><span class="n">addresses</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">records</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">a</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="nb">map</span> <span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">address</span><span class="p">)</span> <span class="n">ipv4Addresses</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">a</span><span class="o">.</span><span class="n">ttl</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">aaaa</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="nb">map</span> <span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">address</span><span class="p">)</span> <span class="n">ipv6Addresses</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">aaaa</span><span class="o">.</span><span class="n">ttl</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">in</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">networking</span><span class="o">.</span><span class="n">domains</span><span class="o">.</span><span class="n">subDomains</span><span class="o">.</span><span class="s2">&#34;</span><span class="si">${</span><span class="n">fqdn</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="n">records</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">networking</span><span class="o">.</span><span class="n">domains</span><span class="o">.</span><span class="n">subDomains</span><span class="o">.</span><span class="s2">&#34;rossabaker.com&#34;</span> <span class="o">=</span> <span class="n">records</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></div>
<h3 id="cname-records">
  CNAME records
  <a class="heading-anchor" href="#cname-records">#</a>
</h3>
<p>All the nginx virtual hosts we&rsquo;ve configured should declare a CNAME
to refer back to this host.</p>
<div class="code-snippet"><p class="license">CC-BY-SA-4.0</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nix" data-lang="nix"><span class="line"><span class="cl"><span class="p">{</span> <span class="n">config</span><span class="o">,</span> <span class="o">...</span> <span class="p">}:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">let</span>
</span></span><span class="line"><span class="cl">  <span class="n">vhosts</span> <span class="o">=</span> <span class="nb">builtins</span><span class="o">.</span><span class="n">attrNames</span> <span class="n">config</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">nginx</span><span class="o">.</span><span class="n">virtualHosts</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">baseDomains</span> <span class="o">=</span> <span class="nb">builtins</span><span class="o">.</span><span class="n">attrNames</span> <span class="n">config</span><span class="o">.</span><span class="n">networking</span><span class="o">.</span><span class="n">domains</span><span class="o">.</span><span class="n">baseDomains</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">isBaseDomain</span> <span class="o">=</span> <span class="n">x</span><span class="p">:</span> <span class="nb">builtins</span><span class="o">.</span><span class="n">elem</span> <span class="n">x</span> <span class="n">baseDomains</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">fqdn</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="si">${</span><span class="n">config</span><span class="o">.</span><span class="n">networking</span><span class="o">.</span><span class="n">hostName</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="n">config</span><span class="o">.</span><span class="n">networking</span><span class="o">.</span><span class="n">domain</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">in</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">networking</span><span class="o">.</span><span class="n">domains</span><span class="o">.</span><span class="n">subDomains</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">    <span class="nb">builtins</span><span class="o">.</span><span class="n">listToAttrs</span> <span class="p">(</span><span class="nb">builtins</span><span class="o">.</span><span class="nb">map</span> <span class="p">(</span><span class="n">vhost</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">name</span> <span class="o">=</span> <span class="n">vhost</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">value</span> <span class="o">=</span> <span class="p">{</span> <span class="n">cname</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="si">${</span><span class="n">fqdn</span><span class="si">}</span><span class="s2">.&#34;</span><span class="p">;</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span> <span class="p">(</span><span class="nb">builtins</span><span class="o">.</span><span class="n">filter</span> <span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="o">!</span><span class="n">isBaseDomain</span> <span class="n">x</span><span class="p">)</span> <span class="n">vhosts</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></div>

    <footer>
      <div class="article-info">
  <dl>
    <div class="type">
      <dt>Type</dt>
      
        <dd><a href="/configs">Config</a></dd>
      
    </div>
    <div class="published">
      <dt>Published</dt>
      <dd>2023-11-19</dd>
    </div>
    <div class="last-modified">
      <dt>Last updated</dt>
      <dd>2024-01-08</dd>
    </div>
    <div class="taxonomies">
      <dt>Taxonomies</dt>
      <dd>
        <dl>
          
            <dt>Categories</dt>
            <dd>
              <ul>
                
                  <li class="category"><a href="https://rossabaker.com/categories/tech">Tech</a></li>
                
              </ul>
            </dd>
          

          
        </dl>
      </dd>
    </div>
  </dl>
</div>

    </footer>
  </article>

    </main>

    <footer>
      
        <div class="h-card vcard">
  <img class="u-photo" alt="Profile photo of Ross A. Baker" src="/img/profile.jpg" />
  <a class="u-url u-uid p-name" href="https://rossabaker.com/">
    <span class="p-given-name">Ross</span>
    <span class="p-additional-name"><abbr>A.</abbr></span>
    <span class="p-family-name">Baker</span>
  </a>
  <small><span class="u-pronoun">(he/him)</span></small><br />
  <address><ul class="contacts">
  
    <li><a href="mailto:ross@rossabaker.com" >
      
      
      <svg width="24" height="24" viewBox="0 0 48 48" fill="currentcolor" xmlns="http://www.w3.org/2000/svg"><title>Email</title><path d="M4 39H44V24 9H24 4V24 39z" fill="none" stroke="currentcolor" stroke-width="4" stroke-linejoin="round"/><path d="M4 9 24 24 44 9" fill="none" stroke="currentcolor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M24 9H4V24" fill="none" stroke="currentcolor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M44 24V9H24" fill="none" stroke="currentcolor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </a></li>
  
    <li><a href="https://social.rossabaker.com/@ross" rel="me">
      
      
      <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Mastodon</title><path d="M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792.0 11.813.0h-.03c-3.98.0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057.0 00.023-.043v-1.809a.052.052.0 00-.02-.041.053.053.0 00-.046-.01 20.282 20.282.0 01-4.709.545c-2.73.0-3.463-1.284-3.674-1.818a5.593 5.593.0 01-.319-1.433.053.053.0 01.066-.054c1.517.363 3.072.546 4.632.546.376.0.75.0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23.0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112.0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311.0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13.0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z"/></svg>
    </a></li>
  
    <li><a href="https://matrix.to/#/@ross:rossabaker.com" >
      
      
      <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Matrix</title><path d="M.632.55v22.9H2.28V24H0V0h2.28v.55zm7.043 7.26v1.157h.033c.309-.443.683-.784 1.117-1.024.433-.245.936-.365 1.5-.365.54.0 1.033.107 1.481.314.448.208.785.582 1.02 1.108.254-.374.6-.706 1.034-.992.434-.287.95-.43 1.546-.43.453.0.872.056 1.26.167.388.11.716.286.993.53.276.245.489.559.646.951.152.392.23.863.23 1.417v5.728h-2.349V11.52c0-.286-.01-.559-.032-.812a1.755 1.755.0 00-.18-.66 1.106 1.106.0 00-.438-.448c-.194-.11-.457-.166-.785-.166-.332.0-.6.064-.803.189a1.38 1.38.0 00-.48.499 1.946 1.946.0 00-.231.696 5.56 5.56.0 00-.06.785v4.768h-2.35v-4.8c0-.254-.004-.503-.018-.752a2.074 2.074.0 00-.143-.688 1.052 1.052.0 00-.415-.503c-.194-.125-.476-.19-.854-.19-.111.0-.259.024-.439.074-.18.051-.36.143-.53.282-.171.138-.319.337-.439.595-.12.259-.18.6-.18 1.02v4.966H5.46V7.81zm15.693 15.64V.55H21.72V0H24v24h-2.28v-.55z"/></svg>
    </a></li>
  
    <li><a href="https://git.rossabaker.com/ross" rel="me">
      
      
      <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Forgejo</title><path d="M16.7773.0c1.6018.0 2.9004 1.2986 2.9004 2.9005s-1.2986 2.9004-2.9004 2.9004c-1.0854.0-2.0315-.596-2.5288-1.4787H12.91c-2.3322.0-4.2272 1.8718-4.2649 4.195l-7e-4 2.1175a7.0759 7.0759.0 014.148-1.4205l.1176-.001 1.3385 2e-4c.4973-.8827 1.4434-1.4788 2.5288-1.4788 1.6018.0 2.9004 1.2986 2.9004 2.9005s-1.2986 2.9004-2.9004 2.9004c-1.0854.0-2.0315-.596-2.5288-1.4787H12.91c-2.3322.0-4.2272 1.8718-4.2649 4.195l-7e-4 2.319c.8827.4973 1.4788 1.4434 1.4788 2.5287.0 1.602-1.2986 2.9005-2.9005 2.9005-1.6018.0-2.9004-1.2986-2.9004-2.9005.0-1.0853.596-2.0314 1.4788-2.5287l-2e-4-9.9831c0-3.887 3.1195-7.0453 6.9915-7.108l.1176-.001h1.3385C14.7458.5962 15.692.0 16.7773.0zM7.2227 19.9052c-.6596.0-1.1943.5347-1.1943 1.1943s.5347 1.1943 1.1943 1.1943 1.1944-.5347 1.1944-1.1943-.5348-1.1943-1.1944-1.1943zm9.5546-10.4644c-.6596.0-1.1944.5347-1.1944 1.1943s.5348 1.1943 1.1944 1.1943 1.1943-.5347 1.1943-1.1943-.5347-1.1943-1.1943-1.1943zm0-7.7346c-.6596.0-1.1944.5347-1.1944 1.1943s.5348 1.1943 1.1944 1.1943 1.1943-.5347 1.1943-1.1943-.5347-1.1943-1.1943-1.1943z"/></svg>
    </a></li>
  
    <li><a href="https://github.com/rossabaker" rel="me">
      
      
      <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63.0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577.0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93.0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176.0.0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22.0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22.0 1.606-.015 2.896-.015 3.286.0.315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
    </a></li>
  
    <li><a href="https://codeberg.org/rossabaker" rel="me">
      
      
      <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Codeberg</title><path d="M11.955.49A12 12 0 000 12.49a12 12 0 001.832 6.373L11.838 5.928a.187.14.0 01.324.0l10.006 12.935A12 12 0 0024 12.49a12 12 0 00-12-12 12 12 0 00-.045.0zm.375 6.467 4.416 16.553a12 12 0 005.137-4.213z"/></svg>
    </a></li>
  
    <li><a href="https://paste.rossabaker.com/ross" rel="me">
      
      
      <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="currentcolor"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.57 1.14l3.28 3.3.15.36v9.7l-.5.5h-11l-.5-.5v-13l.5-.5h7.72l.35.14zM10 5h3l-3-3v3zM3 2v12h10V6H9.5L9 5.5V2H3zm2.062 7.533 1.817-1.828L6.17 7 4 9.179v.707l2.171 2.174.707-.707-1.816-1.82zM8.8 7.714l.7-.709 2.189 2.175v.709L9.5 12.062l-.705-.709 1.831-1.82L8.8 7.714z"/></svg>
    </a></li>
  
    <li><a href="/projects/finger" >
      
      
      <svg width="24" height="24" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"><title>Finger</title><path d="M12.5658 26.1824C10.8553 27.3542 10 29.2935 10 32.0002c0 4.0601 4.9753 11 9.4618 11s7.0884.0 11.4797.0c4.3913.0 7.0585-3.8506 7.0585-6.9399.0-4.3504.0-8.7007.0-13.051.0-1.6569-1.3431-3-3-3H34.9909C33.3391 20.0093 32 21.3484 32 23.0002" stroke="currentcolor" stroke-width="4" stroke-linecap="round" style="fill:none"/><path d="M13.981 28.4452V8.00587c0-1.65551 1.342-2.99757 2.9975-2.99757.0028.0.0056.0.0083 1e-5 1.6614.0046 3.0059 1.35275 3.0059 3.01419V23.592" stroke="currentcolor" stroke-width="4" stroke-linecap="round" style="fill:none"/><path d="m19.9927 23.0083v-3.9928c0-1.6654 1.3501-3.0155 3.0155-3.0155 1.6654.0 3.0154 1.3501 3.0154 3.0155v3.9928" stroke="currentcolor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" style="fill:none"/><path d="m26 22.7158v-2.7124c0-1.6568 1.3431-3 3-3s3 1.3432 3 3v3" stroke="currentcolor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" style="fill:none"/></svg>
    </a></li>
  
    <li><a href="https://keyoxide.org/ross%40rossabaker.com" >
      
      
      <svg width="1024" height="1024" viewBox="0 0 1024 1024" style="clip-rule:evenodd;fill-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2"><title>Keyoxide</title><defs id="defs19"><mask maskUnits="userSpaceOnUse" id="mask5391"><g id="g5411" style="clip-rule:evenodd;display:inline;fill-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2"><rect id="rect5393" x="-2.0001934" y="2" width="1024" height="1024" style="clip-rule:evenodd;display:inline;fill:#fff;fill-opacity:1;fill-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2"/><g id="g5409" style="clip-rule:evenodd;display:inline;fill:#000;fill-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2"><g id="g5397" transform="scale(0.264583)" style="fill:#000"><path d="m2253.77 664.99c-104.02.001-188.34 84.324-188.34 188.342.0 62.866 31.2 120.27 81.08 154.838 14.37 9.95 22.63 11.1 24.54 26.67 1.92 15.56-19.41 29.99-19.41 29.99l-983.69 765.1c-88.43 68.8-140.16 174.56-140.17 286.6v725.67c0 200.54 162.56 363.1 363.09 363.1s363.1-162.56 363.1-363.1v-548.09l948.32-737.56c139.21-108.27 179.15-299.23 99.99-452.74-5.91-11.46-7.79-15.53-20.1-20.31-12.3-4.78-22.2.57-34.51 5.19-16.92 6.35-34.93 9.65-53.21 9.65-83.65.0-151.47-67.81-151.47-151.465.01-11.352 2.02-18.009-1.34-25.073s-12.29-11.63-21.08-12.633c-14.59-1.666-29.27-2.446-43.97-2.333-14.42.109-25.38-1.186-31.6-11.734-6.21-10.549-2.88-22.638-2.88-41.77.0-104.021-84.33-188.345-188.35-188.342z" style="fill:#000;fill-rule:nonzero" id="path5395"/></g><path d="m464 508.622 245.251 163.501c44.085 29.39 56.016 89.043 26.626 133.128-29.39 44.085-89.043 56.016-133.128 26.626l-288-192C288.042 622.072 272 592.098 272 560V336c0-52.984 43.016-96 96-96s96 43.016 96 96z" style="fill:#000" id="path5399"/><circle id="circle5401" cx="503.53201" cy="185.784" r="33.993" style="fill:#000"/><circle id="circle5403" cx="535.98901" cy="119.866" r="22.177999" style="fill:#000"/><circle id="circle5405" cx="475.59799" cy="103.58" r="15.485" style="fill:#000"/><circle id="circle5407" cx="712.90997" cy="250.52699" r="27.167999" style="fill:#000"/></g></g></mask></defs><g id="bg_color_circle" style="display:inline"><g id="bg_color_circle_element" style="clip-rule:evenodd;display:inline;fill-opacity:1;fill-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2" mask="url(#mask5391)"><rect id="rect840" x="0" y="0" width="1024" height="1023.9998" style="display:inline;fill-opacity:1" ry="511.99991"/></g></g></svg>
    </a></li>
  
</ul>
</address>
</div>

<p><a href="/license/">License</a> <a href="/security/">Security policy</a></p>

<small class="indiewebring">
  <a href="https://xn--sr8hvo.ws/previous">←</a>
  An <a href="https://xn--sr8hvo.ws">IndieWeb Webring</a> 🕸💍
  <a href="https://xn--sr8hvo.ws/next">→</a>
</small>

<script type="text/javascript"
        src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

      
    </footer>
  </body>
</html>
